% -----------------------------------------------
% Template for ISMIR Papers
% 2016 version, based on previous ISMIR templates

% Requirements :
% * 6+1 page length maximum
% * 2MB maximum file size
% * Copyright note must appear in the bottom left corner of first page
% (see conference website for additional details)
% -----------------------------------------------

\documentclass{article}
\usepackage{ismir,amsmath,cite}
\usepackage{graphicx}
\usepackage{color}

% ------
\title{Good-sounds.org: a framework to explore goodness in instrumental sounds}

% ------------
\multauthor
{Giuseppe Bandiera$^1$ \hspace{1cm} Oriol Romani Picas$^1$ \hspace{1cm} Hiroshi Tokuda$^2$} { \bfseries{Wataru Hariya$^2$ \hspace{1cm} Koji Oishi$^2$ \hspace{1cm} Xavier Serra$^1$}\\
  $^1$ Music Technology Group, Universitat Pompeu Fabra, Barcelona, Spain\\
$^2$ Technology Development Dept., KORG Inc., Tokyo, Japan\\
{\tt\small giuseppe.bandiera@upf.edu, oriol.romani@upf.edu}
}
\def\authorname{Giuseppe Bandiera, Oriol Romani Picas, Hiroshi Tokuda, Wataru Hariya, Koji Oishi, Xavier Serra}


\sloppy % please retain sloppy command for improved formatting

\begin{document}

%
\maketitle
%
\begin{abstract}
We introduce good-sounds.org, a framework to explore the concept of goodness in instrumental sounds. Musicians can upload their sounds and vote on existing sounds, and from that data the system is able to develop sound goodness measures of relevance for music education applications. The core of the system is a database of sounds, together with audio features extracted from them and user annotations related to the goodness of the sounds. The features are extracted using various algorithms from the Essentia software library and the web front-end provides useful data visualisations of the sound attributes and tools to facilitate user interaction. To evaluate the framework we carried out an experiment to rate sound goodness on single notes of nine different instruments. Users rated the sounds using an AB vote over a set of sound attributes defined for characterizing single notes of instrumental sounds. With the obtained votes we built a ranking of the sounds for each attribute and then from the ranking we developed a model that rates the goodness for each of the selected sound attributes. Using this approach we have succeeded in obtaining results comparable to a model that was built from expert generated evaluations.
\end{abstract}
%
\section{Introduction}\label{sec:introduction}

Measuring sound goodness, or quality, in instrumental sounds is difficult due to its intrinsic subjectivity. Nevertheless, it has been shown that there is some consistency among people while discriminating good or bad music performances \cite{1}. Furthermore, recent studies have demonstrated a correlation between the perceived music quality and the musical performance technique \cite{2}. Bearing this in mind, in a previous work \cite{01} we proposed a method to automatically rate goodness by defining a set of sound attributes and by using a set of good/bad labels given by  expert musicians. The definition of goodness was treated as a classification problem and an outcome of that work was a mobile application (Cortosia) that gives goodness scores in real-time for single notes and on a scale from 0 to 100. This score was computed considering the distribution of the features values in the classification step. While developing that system we realised that we could improve the scores, specially their correlation with the perceptual sound goodness, if we could use more training data and include a range of goodness levels given by users rather than the binary good/bad labels that we used. However, the task of labeling sounds this way would have been very time consuming and we would  also need more sounds, covering the whole range of sound goodness. To address these issues we are now crowsourcing the problem. We have developed a website, good-sounds.org, on which users can upload sound content and can tag sounds in various ways.      
%
\section{good-sounds.org}\label{sec:goodsounds}
Good-sounds.org\footnote{\textit{https://good-sounds.org/}} is a web platform to explore the concept of goodness in instrumental sounds with the help of a community of users. The website provides social community features in the front-end and a framework for sound analysis and modeling in the background. It also includes an API to access the collected data.

\begin{figure}[ht]
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/sound_list.png}}}
 \caption{Good-sound.org sound list page.}
 \label{fig:sound_list}
\end{figure}

\subsection{Description} 
The website has been designed from a user perspective, meant to be modern and to provide a seamless experience. It makes use of state of the art designing concepts and community oriented web technologies. The front-end includes three main sections: (1) a visualisation page for the uploaded sounds that is shown in Figure~\ref{fig:sound_list}, (2) a page to  upload and describe sounds shown in Figure~\ref{fig:upload} and (3) and a section to gather user annotations. The visualisation page shows a list of all the sounds in the database that can be filtered by several options like instrument or uploading date. The upload page allows the users to add or drag sounds into the site and also provides a recording tool built using Web Audio API\footnote{\textit{http://www.w3.org/TR/webaudio/}}. The annotation section has been designed for the specific experiment explained in section 3. 
The website backend is written in Python using the Django web application framework. The metadata is stored in a PostgreSQL database while the files are stored locally in the server. An API accepts requests from authorized clients to upload sounds (currently through the mobile app Cortosia) and retrieve statistics from the user’s community. 
At this time, the website supports 11 instruments, it includes 8470 unique sounds and there are 363 active users. 

\begin{figure}
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/upload.png}}}
 \caption{Good-sound.org upload page.}
 \label{fig:sound_list}
\end{figure}

\subsection{Content}
The core data stored in good-sounds.org consists of sounds and the metadata accompaning them. When uploading sounds the users can choose between three different types of Creative Commons licenses for their content: Universal, Attribution or Attribution Non-Commercial. As soon as a sound is uploaded, it is analyzed using the freesound extractor \cite{02}, thus obtaining a number of low-level audio features, and the system generates an mp3 version of the file together with images of the waveform and spectrogram. The audio,  image and audio feature files are stored in the good-sounds server and the metadata is stored in the PostgreSQL database. 

\subsubsection{Segmentation}
One of the critical audio processing steps  performed in good-sounds.org is the segmentation of the uploaded audio files to find appropiate note boundaries. As the audios come from different and not well controlled sources, they might include all kinds of issues (ex. silence at begining and end, background noise, ...) that can difficult the subsequent feature extraction step. Considering that the sounds we are working with are all monophonic pitched instrument sounds, we can base the segmentation on pitch. Our approach extracts pitch using Essentia’s \cite{03} implementations of the YinFFT algorithm \cite{04} and the Yin time based algorithm \cite{05}. Then the sound is segmented into notes using pitch contours \cite{06} and signal RMS with Essentia’s PitchContourSegmentation algorithm.  
All the segmentation data is also stored in the database. This allows us to build client-side data visualizations that effectively reflect the quality of the segmentation algorithm. Moreover, the user can modify the parameters for this algorithm and re-run it on the fly from the website. The results of this iteration is immediately shown on the same page, for an easy comparison of the results, as it is shown in Figure~\ref{fig:segmentation}.

\begin{figure}[ht]
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/segmentation.png}}}
 \caption{Good-sound.org segmentation visualisation page.}
 \label{fig:segmentation}
\end{figure}

\subsubsection{Descriptors}
The feature extraction module used \cite{02} computes spectral, tonal and temporal descriptors. The audios are resampled to 44.1kHz sampling rate and normalised using replay gain. The descriptors are then extracted across all the frames using a 2048 window size and 512 hop window size. We then compute statistical measures (mean, median and standard deviation) of the descriptors which are the values stored as JSON files in the server. A list of the descriptors we extract is shown in Table~\ref{table:descriptors}. 

\begin{table*}[ht]
\centering
\begin{tabular}{lll}
\hline
spectral                                                                                                                                                                                 & tonal                                      & temporal                                            \\ \hline
\begin{tabular}[c]{@{}l@{}}spectrum, barkbands, \\ melbands, flatness, crest, rolloff, \\ decrease, hfc, pitch salience, flatness db, \\skewness, kurtosis, spectral complexity,\end{tabular} & pitch yinfft, pitch yin, pitch confidence, & zerocrossingrate, loudness, centroid, \\flatness sfx, \\
\hline
\end{tabular}
\caption{Descriptors extracted by Essentia library present in good-sounds.org}
\label{table:descriptors}
\end{table*}


\section{Experiment} \label{experiment}
As a test case to evaluate the usefulness of the good-sounds.org framework we setup an experiment to rate the goodness of single notes. The goal of the experiment was to build models from the uploaded sounds and the community annotations with which we can then automatically rate the sound goodness. We then compared the results of these models with the ones we obtained in our previous work using the expert annotations.  

\subsection{Dataset}
The data used in this experiment comes from several sources. First, we uploaded all the sounds from our previous work to the website, together with the expert annotations. The website has been public for a few months, thus we had the sounds uploaded by the users, both directly and through the mobile app (using the API). Finally, user annotations on the sounds according to a goodness scale where collected using a voting task. These annotations are taken using to a set of sound attributes that affect sound goodness. We defined these attributes in our previous work together with a group of music experts:   
\begin{itemize}
	\item{\textit{dynamic stability}: the stability of the loudness.}
	\item{\textit{pitch stability}: the stability of the pitch.}
	\item{\textit{timbre stability}: the stability of the timbre.}
	\item{\textit{timbre richness}: the quality of the timbre.}
	\item{\textit{attack clarity}: the quality of the attack.}
\end{itemize}

\subsubsection{Sounds}
For this experiment we selected only the single note sounds. At the time of the experiment there were sounds for 5467 single notes of 9 instruments. We show the list of sounds per instrument in Table~\ref{sounds}. The sounds we recorded ourselves from the recording sessions are uncompressed wave files, while the ones uploaded by users to the website are in different audio formats.  

\begin{table}[ht]
\centering
\begin{tabular}{cc}
\hline
instrument   & number of sounds \\ \hline
cello        & 935              \\
violin       & 802              \\
clarinet     & 1360             \\
flute        & 1434             \\
alto sax     & 352              \\
baritone sax & 292              \\
tenor sax    & 292              \\
soprano sax  & 343              \\
trumpet      & 738              \\ \hline
\end{tabular}
\caption{Number of sounds in the experiment's dataset.}
\label{sounds}
\end{table}

\subsubsection{Annotations}
We distinguish two kind of annotations: (1) recording annotations and (2) community annotations. The recording annotations are the ones coming from the recording sessions that we did and consists of one tag per sound. This tag says if the sound is a good or a bad example of each sound attribute (e.g. bad-timbre-stability, good-attack-clarity…). Those are the annotations used later on for a first evaluation of the models and are only available for the sounds we recorded ourselves.
The community annotations are the ones generated from the user votes and used in this work to explore goodness. In order to be able to rate a sound in a goodness scale we need annotations on a wide range of different goodness levels. We originally thought of asking the community to rate sounds in a scale of goodness but we discarded this option because of the following:

\begin{itemize}
	\item{the task can be excessively demanding.}
	\item{without a reference sound the criteria of different users can differ extremely.}
	\item{with a reference sound we influence the user’s criteria, thus annotations can be less 	generalisable.}
\end{itemize}

Instead, we designed a user task that gave as outcome a ranked list of the sounds based on the goodness for each sound attribute. An A/B multi vote task was used for this purpose. Two sounds are presented and the user is asked to decide which sound is better according to one or more of the sound attributes. On vote is stored for each selected attribute. A list of the votes per instruments (considering all sound attributes) is shown in Table~\ref{votes}.
In order to prevent random votes in the task we run checks periodically. This checks consists of two sounds; one being a bad example of a sound attribute regarding the expert annotations and the other being a good example. The task is presented to the users the first time they vote and also randomly after some votes. If the user does not vote for the sound is expected in the reference task, his next votes are not considered. The votes of this user are again taken into account if he succeeds on the reference task. 


\begin{table}[ht]
\centering
\begin{tabular}{cc}
\hline
instrument   & number of votes \\ \hline
cello        & 140             \\
violin       & 90              \\
clarinet     & 293             \\
flute        & 305             \\
alto sax     & 78              \\
baritone sax & 59              \\
tenor sax    & 14              \\
soprano sax  & 21              \\
trumpet      & 230             \\ \hline
\end{tabular}
\caption{Number of votes in good-sounds for the dataset's experiment.}
\label{votes}
\end{table}

\subsubsection{Rankings}
In order to have learning data in a wide range of goodness we built rankings with the community votes for each sound attribute. The position of a sound in the ranking represents its goodness level. To build them we count the number of wins and the number of votes of each sound in the database. Then the sounds are sorted according to two parameters: 

\begin{itemize}
	\item{total number of votes: number of participations in the voting task.}
	\item{ratio between wins and votes: the ratio between the number of wins and the total number of participations in the voting task.}
\end{itemize}
  
Using these parameters for building the rankings we assure that the sounds in the top are the ones voted more times as being better than others and not sounds with few votes but high percentage of wins.

\subsection{Learning}
The goal of our learning process is to build a model for each instrument that is able to rate each sound attribute in a 0 to 100 score. To do so we want to find a set of features that highly correlate with the rankings extracted in the previous step.  
Our approach uses a regression model to predict the score. These predictions are then used as samples of the final score function. The final score is then computed as an interpolation of the samples.

\subsubsection{Models}
We want to find the combination of regression model and set of features that better describes the rankings. For such a purpose we use all the different regression algorithms available in scikit-learn \cite{08}.  For each one of the algorithms we build a model for each ranking using one, two or three features and we compute the average prediction score of the model across all the options. The prediction score $R^2$ is defined in the scikit-learn documentation as follows:

\begin{equation}
 R^2 = (1 - u/v) 
\end{equation}
where
\begin{equation}
	u = \sum\nolimits((y_{true} - y_{pred})^2)
\end{equation}
and
\begin{equation}
	v = \sum\nolimits((y_{true} - \prod\limits_{i=1}^n y_{true})^2)
\end{equation}

Where $y_{true}$ is the set of ground truth annotations and $y_{pred}$ the set of predictions, having both the same length. The best possible score $R^2$ is 1.0 and it can be negative.
The variance of the prediction score across all the rankings and set of features is also computed. 
The number of features that give the best score for each ranking is taken into account to compute an average number of features for each regression model. A comparison of the performance of the different models is shown in Table~\ref{models}.

\begin{table*}[ht]
\centering
\label{my-label}
\begin{tabular}{cccc}
\hline
Regression model  & Avg. score & Score variance & Average of features \\ \hline
SVR               & -1.208     & 5.4436         & 1.843               \\
Ridge             & -2.644     & 31.005         & 2.166               \\
KRR               & -1.79      & 10.798         & 1.906               \\
Linear regression & -3.503     & 30.03          & 1.718               \\
RANSAC            & -3.202     & 17.532         & 1.478               \\
Theilsen          & -4.14      & 37.135         & 1.781               \\ \hline
\end{tabular}
\caption{Performance of the different regression models.}
\label{models}
\end{table*}

As we can see in the table the SVR (Epsilon-Support Vector Regression) model has the best average score across all the rankings and using all possible combination of feature sets (up to 3 features). It also has the lowest score variance so we can expect the model to be robust across the different instruments and sound attributes. However the average number of features is almost two and the computation of two features at each frame of all the sounds in the database can be computationally expensive. For this reason we want to know how good the model can be if we force it to use less than three features. We show the results of such a comparison in Table~\ref{svr}.

\begin{table}[]
\centering
\label{my-label}
\begin{tabular}{lll}
\hline
Regression model & Avg. score & Score variance \\ \hline
SVR 3 features   & -1.208     & 5.4436         \\
SVR 2 features   & -1.2411    & 5.3895         \\
SVR 1 feature    & -1.4254    & 5.6554         \\ \hline
\end{tabular}
\caption{Performance of SVR model with differnet number of features.}
\label{svr}
\end{table}

The results show that the use of more than one feature dos not give significally better results so we decided to use SVR with a single feature. We then tried all possible combinations of parameters (kernel, degree of polinomiality, cost parameter..) to find the best model for each instrument and sound attribute.

\subsubsection{Scores}
From the model we are able to predict the ranking position of a sound. We then map this position into a 0 to 100 score of the sound attribute. The final goodness score is computed as the average score across the five attributes. We compute the sound attribute scores of all the sounds in the database to test the distribution of the scores according to the feature value. For example, a distribution of the score for the timbre stability of flute is shown in Figure~\ref{fig:scores}.

\begin{figure}[ht]
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/distribution_1.png}}}
 \caption{Distribution of scores of flute timbre stability.}
 \label{fig:scores}
\end{figure}

The resulting distributions are not balanced. For this reason we push the scores of each sound attribute to fit a Gaussian distribution. This gives us balanced distributions and it also allows us to refine the scores by tweaking the parameters of the gaussian function. A result of this process is shown in Figure~\ref{fig:scores_2}. The final score is computed interpolating the feature according to these tuned distributions. 

\begin{figure}[ht]
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/distribution_2.png}}}
 \caption{Distribution of scores of flute timbre stability after normalisation.}
 \label{fig:scores_2}
\end{figure}

\subsubsection{Models evaluation}
In order to evaluate if the scores provided by the models fit the perceived goodness, we used the expert annotations of our previous work. These annotations only describe if the sound is a good or a bad example of one of the sound attributes defined previously. A model for each sound attribute of each instrument is trained using the rankings described previously. These rankings are built with all the sounds from which we have votes (around 20\% of the sounds in the dataset). We use the models to compute the scores of all the sounds in the dataset and then we use the data visualisation tools implemented in the website to visualise the scores according to the expert annotations. An example of this using flute timbre stability is shown in Figure~\ref{fig:scores}. The visualisation tools read from database so just by training models the results are instantly shown in the web page. 

\begin{figure}
 \centerline{\framebox{
 \includegraphics[width=\columnwidth]{figs/scores.png}}}
 \caption{Visualisation of scores through the website tools.}
 \label{fig:scores_3}
\end{figure}

We expect the scores of good examples to be higher than 50 and the bad ones lower than 50. The number of sounds per sound attribute with scores above and below 50 according to their tags are shown in Table~\ref{results}.

\begin{table}[ht]
\centering
\begin{tabular}{lll}

             & Dynamics stability     &                    \\ \hline
sound tag    & score \textgreater= 50 & score \textless 50 \\ \hline
good sound   & 1846                   & 872                \\
bad dynamics & 438                    & 881                \\
             &                        &                    \\

             & Timbre stability       &                    \\ \hline
sound tag    & score \textgreater= 50 & score \textless 50 \\ \hline
good sound   & 930                    & 429                \\
bad timbre   & 224                    & 472                \\
             &                        &                    \\

             & Pitch stability        &                    \\ \hline
sound tag    & score \textgreater= 50 & score \textless 50 \\ \hline
good sound   & 1260                   & 99                 \\
bad pitch    & 125                    & 636                \\
			 &                        &                    \\

             & Timbre richness        &                    \\ \hline
sound tag    & score \textgreater= 50 & score \textless 50 \\ \hline
good sound   & 1184                   & 175                \\
bad richness & 380                    & 268                \\
             &                        &                    \\

             & Attack clarity         &                    \\ \hline
sound tag    & score \textgreater= 50 & score \textless 50 \\
good sound   & 1005                   & 354                \\
bad attack   & 553                    & 294                \\ \hline
\end{tabular}
\caption{Number of sounds for each sound attribute with scores higher or lower than 50.}
\label{results}
\end{table}

As we can see, the models seem to perform better in rating good sound examples. We can consider as correct predictions the sounds with “good sound” tag and score > 50 as well as the ones having “bad attribute” tag and score < 50. Thus there are 8778 correct predictions out of 12427. 
As future work we want to also evaluate the models by using community annotations on scores.

\section{Conclusions}
In this article we presented a web based framework for exploring sound goodness in instrumental sounds using a community of users. The framework provides an easy way to collect sounds and annotations as well as tools to extract and store music descriptors. This allows us to explore the concept of sound goodness in a controlled and flexible environment. Furthermore, the website is useful to the community as a place in which to discuss the issues affecting sound goodness as well as a learning tool to improve their playing techniques. 
As a way to evaluate the framework we extended the work presented in [1] by using annotations from the community collected through a voting task. The models built using this approach provide an automatic rating of goodness for each attribute that tends to match the expert annotations collected in our previous work. The results should improve with more annotations from the community.
As future work we want to design new tasks to collect user annotations and build new models according to them. 

\section{Acknowledgements}
This research has been partially funded by KORG Inc. The authors would like to thank the entire good-sounds.org community who contributed to the website with sounds and annotations.

% For bibtex users:
%\bibliography{ISMIRtemplate}

% For non bibtex users:
\begin{thebibliography}{citations}
%
\bibitem {1}
J. Geringer and C. Madsen
``Musicians ratings of good versus bad vocal and string performances''
{\it Journal of Research in Music Education}, vol. 46, pages 522-34, 1998.

\bibitem {2}
Brian E. Russell
``An empirical study of a solo performance assessment model''
{\it  International Journal of Music Education}, vol. 33, pages 359-371, 2015.

\bibitem {01}
O. Romani Picas et al.
``A real-time system for measuring sound goodness in instrumental sounds,''
{\it AES 138th Convention Warsaw}, 2015.

\bibitem {02}
 F. Font, G. Roma, and X. Serra
``Freesound technical demo,''
{\it Proceedings of the 21st ACM international conference on Multimedia.}, 2013.

\bibitem {03}
 D. Bogdanov et al.
``Essentia: An audio analysis library for music information retrieval,''
{\it  In Proceedings of the International Society for Music Information Retrieval Conference.}pages 493–498, 2013.

\bibitem {04}
 P. M. Brossier
``Automatic Annotation of Musical Audio for Interactive Applications''
{\it QMUL, London, UK,}, 2007.

\bibitem {05}
 A. de Cheveigné and H. Kawahara.
``YIN, a fundamental frequency estimator for speech and music''
{\it The Journal of the Acoustical Society of America}111:1917, 2002.

\bibitem {06}
 R. J. McNab et al.
``Signal processing for melody transcription''
{\it In Proceedings of the 19th Australasian Computer Science Conference}, 1996.

\bibitem {07}
P. M. Brossier.
``Automatic Annotation of Musical Audio for Interactive Applications''
{\it Ph.D. Thesis, Queen Mary University of London, UK}, 2007.

\bibitem {08}
Pedregosa et al.
``Scikit-learn: Machine Learning in Python''
{\it JMLR 12}, pages. 2825-2830, 2011.


\end{thebibliography}

\end{document}
